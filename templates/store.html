<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>{{ m.business_name }} — Store</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root{
      --bg:#0b0f17; --card:#0f1728; --line:#1f2a44; --txt:#e8f0ff; --muted:#bcd0ff; --brand:#6e9fff; --btn:#0b0f17;
    }
    /* COLORWAYS (set by body.cw-*) */
    body.cw-blue  { --brand:#6e9fff; }
    body.cw-rose  { --brand:#ff7eb3; }
    body.cw-emerald{ --brand:#34d399; }
    body.cw-violet{ --brand:#a78bfa; }
    body.cw-gold  { --brand:#f6c453; }
    body{font-family:{{ m.font_family or 'system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif'}}; background:var(--bg); color:var(--txt); margin:0}
    a{color:inherit}
    .wrap{max-width:980px;margin:0 auto;padding:16px}
    .top{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
    .logo{height:36px;width:auto;border-radius:8px;border:1px solid var(--line);background:#fff}
    .banner{width:100%;max-height:180px;object-fit:cover;border-radius:14px;border:1px solid var(--line);display:block;margin:8px 0 14px}
    .muted{color:var(--muted)}
    .pill{display:inline-block;background:rgba(255,255,255,.06);border:1px solid var(--line);padding:6px 10px;border-radius:999px}
    .btn{background:var(--brand);color:var(--btn);border:0;border-radius:10px;padding:10px 12px;font-weight:800;cursor:pointer;text-decoration:none;display:inline-block}
    .btn-outline{background:transparent;border:1px solid var(--line);color:var(--txt)}
    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:14px}
    @media (max-width:660px){ .grid{grid-template-columns:1fr} }
    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:12px;display:flex;flex-direction:column}
    .thumb{width:100%;aspect-ratio:1/1;border-radius:10px;border:1px solid var(--line);object-fit:cover;background:#0a1120}
    .title{font-weight:800;margin:8px 0 4px}
    .price{color:var(--muted)}
    .row{display:flex;gap:8px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .hdr{display:flex;justify-content:space-between;align-items:center;gap:12px;margin:8px 0 16px}
    .search{flex:1;display:flex;gap:6px}
    .search input{flex:1;border:1px solid var(--line);background:#0a1120;color:var(--txt);border-radius:10px;padding:10px}
    .cart{position:relative}
    .badge{position:absolute;top:-6px;right:-6px;background:var(--brand);color:#0b0f17;border-radius:999px;font-size:12px;line-height:1;padding:3px 7px;border:1px solid #0005}
    .alert{background:#102031;border:1px solid #204060;color:#bde0fe;padding:10px 12px;border-radius:10px;margin:10px 0}
  </style>
</head>
<body class="theme-{{ m.theme|e }} cw-{{ m.colorway|e }}">
  <div class="wrap">

    <!-- Success notice (after payment) -->
    {% if request.args.get('success') %}
      <div class="alert">✅ Payment succeeded! The merchant will email updates (tracking if available).</div>
    {% endif %}

    <!-- Store header -->
    {% if m.banner_url %}
      <img class="banner" src="{{ m.banner_url }}" alt="">
    {% endif %}

    <div class="top">
      {% if m.logo_url %}
        <img class="logo" src="{{ m.logo_url }}" alt="">
      {% endif %}
      <div>
        <div style="font-weight:900;font-size:20px">{{ m.business_name }}</div>
        {% if m.description %}
          <div class="muted" style="max-width:68ch">{{ m.description }}</div>
        {% endif %}
        <div class="muted" style="margin-top:6px">Signed in as <span class="pill">@{{ username }}</span></div>
      </div>
    </div>

    <!-- controls -->
    <div class="hdr">
      <form class="search" method="get" action="/store/{{ m.slug }}">
        <input type="hidden" name="cid" value="{{ cid }}">
        <input type="text" name="q" value="{{ q }}" placeholder="Search products…">
        <button class="btn btn-outline" type="submit">Search</button>
      </form>

      <div class="cart">
        <a class="btn" href="/cart/{{ cid }}">Cart</a>
        {% if cart_count and cart_count|int > 0 %}
          <span class="badge">{{ cart_count }}</span>
        {% endif %}
      </div>
    </div>

    <!-- product grid -->
    <div class="grid">
      {% for it in items %}
        <div class="card">
          {% if it.image_url %}
            <img class="thumb" src="{{ it.image_url }}" alt="">
          {% else %}
            <div class="thumb" style="display:grid;place-items:center;color:#99a"><span>No image</span></div>
          {% endif %}

          <div class="title">{{ it.title }}</div>
          <div class="price">{{ '%.7f'|format(it.pi_price|float) }} Pi</div>

          <div class="row" style="margin-top:10px">
            <form method="post" action="/store/{{ m.slug }}/add" style="display:flex;gap:8px;align-items:center">
              <input type="hidden" name="cid" value="{{ cid }}">
              <input type="hidden" name="item_id" value="{{ it.id }}">
              <input type="hidden" name="qty" value="1">
              <button class="btn" type="submit">Add to cart</button>
            </form>

            <a class="btn btn-outline" href="/checkout/{{ it.link_id }}">Buy now</a>
          </div>
        </div>
      {% endfor %}
    </div>

    {% if not items or items|length == 0 %}
      <p class="muted" style="margin-top:16px">No items yet.</p>
    {% endif %}
  </div>
</body>
</html>
