<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>{{ m.business_name }} — Store</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root{
      --bg:#0b0f17; --card:#0f1728; --line:#1f2a44; --txt:#e8f0ff; --muted:#bcd0ff; --brand:#6e9fff;
      --btn-txt:#0b0f17;
    }
    /* colorways used across the app */
    .cw-blue  { --brand:#6e9fff; }
    .cw-mint  { --brand:#5ad49e; }
    .cw-purple{ --brand:#a88cff; }
    .cw-amber { --brand:#ffb86b; }

    /* optional light variant */
    .light { --bg:#f6f7fb; --card:#ffffff; --line:#e6e8f0; --txt:#0b0f17; --muted:#4b587c; --btn-txt:#ffffff; }

    body{font-family:{{ m.font_family or 'Arial,Helvetica,sans-serif' }}; background:var(--bg); color:var(--txt); margin:0}
    .wrap{max-width:980px;margin:0 auto;padding:16px}
    .top{display:flex;align-items:center;gap:12px;padding:8px 0;flex-wrap:wrap}
    .top .grow{flex:1}
    .logo{height:40px;border-radius:8px;border:1px solid var(--line);background:#0001}
    .banner{width:100%;max-height:180px;object-fit:cover;border-radius:12px;border:1px solid var(--line);display:block}
    .muted{color:var(--muted)}
    input, .btn, .pill{border-radius:10px}
    input{width:100%;background:transparent;border:1px solid var(--line);padding:10px;color:var(--txt)}
    .btn{background:var(--brand);color:var(--btn-txt);border:0;padding:10px 12px;font-weight:800;text-decoration:none;display:inline-block;cursor:pointer}
    .pill{border:1px solid var(--line);padding:8px 10px;text-decoration:none;color:var(--txt);background:transparent;cursor:pointer}

    /* Cart badge */
    .cart-link{position:relative; display:inline-block}
    .badge{
      position:absolute; top:-6px; right:-6px;
      min-width:18px; height:18px; padding:0 5px;
      border-radius:999px; background:var(--brand); color:var(--btn-txt);
      font-size:12px; line-height:18px; text-align:center; font-weight:800;
      border:1px solid var(--line);
    }

    .grid{display:flex;flex-wrap:wrap;gap:12px;margin-top:14px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:12px;flex:1 1 calc(50% - 12px);min-width:260px;box-sizing:border-box}
    .card img{width:100%;height:180px;object-fit:cover;border-radius:10px;border:1px solid var(--line);background:#0001}
    .row{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
    .price{font-weight:800}
    .header{display:flex;align-items:center;gap:10px;justify-content:space-between;flex-wrap:wrap}
    .desc{margin-top:6px;color:var(--muted);font-size:.95rem}
    @media (max-width:540px){
      .card{min-width:calc(50% - 12px)}
    }
  </style>
</head>
{% set cw = m.colorway if m and m.colorway else 'cw-blue' %}
<body class="{{ cw }} {% if m.theme_mode=='light' %}light{% endif %}">
<div class="wrap">

  {% if m.banner_url %}
    <img class="banner" src="/uimg?src={{ m.banner_url | urlencode }}" alt="">
  {% endif %}

  <div class="top">
    {% if m.logo_url %}
      <img class="logo" src="/uimg?src={{ m.logo_url | urlencode }}" alt="">
    {% endif %}
    <div class="grow">
      <div class="header">
        <div>
          <div style="font-weight:800;font-size:1.15rem">{{ m.business_name }}</div>
          {% if m.description %}<div class="muted" style="margin-top:3px">{{ m.description }}</div>{% endif %}
        </div>

        <!-- Explore + Cart (badge shows when > 0) -->
        <div class="row">
          <a class="pill" href="/explore{% if request.args.get('t') %}?t={{ request.args.get('t') }}{% endif %}">Explore stores</a>
          <a class="pill cart-link" href="/cart/{{ cid }}{% if request.args.get('t') %}?t={{ request.args.get('t') }}{% endif %}">
            Cart
            {% set cc = (cart_count or 0) %}
            {% if cc > 0 %}<span class="badge">{{ cc }}</span>{% endif %}
          </a>
          {% if (cart_count or 0) > 0 %}
            <a class="pill" href="/checkout/cart/{{ cid }}{% if request.args.get('t') %}?t={{ request.args.get('t') }}{% endif %}">
              Checkout ({{ cart_count }})
            </a>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <form method="get" class="row" action="/store/{{ m.slug }}" style="gap:8px;margin-top:8px">
    <input name="q" value="{{ q or '' }}" placeholder="Search products…">
    <input type="hidden" name="cid" value="{{ cid }}">
    {% if request.args.get('t') %}<input type="hidden" name="t" value="{{ request.args.get('t') }}">{% endif %}
    <button class="btn" type="submit">Search</button>
  </form>

  <div class="grid">
    {% for it in items %}
      <div class="card">
        {% if it.image_url %}
          <img src="/uimg?src={{ it.image_url | urlencode }}" alt="">
        {% endif %}
        <div style="margin-top:8px;font-weight:800">{{ it.title }}</div>
        {% if it.description %}
          <div class="desc">{{ it.description }}</div>
        {% endif %}
        <div class="row" style="justify-content:space-between;margin-top:8px">
          <div class="price">{{ '%.7f'|format(it.pi_price) }} Pi</div>
          <div class="row">
            <!-- Add to Cart (posts to /store/<slug>/add and carries cid) -->
            <form method="post" action="/store/{{ m.slug }}/add" style="margin:0">
              <input type="hidden" name="cid" value="{{ cid }}">
              <input type="hidden" name="item_id" value="{{ it.id }}">
              {% if request.args.get('t') %}<input type="hidden" name="t" value="{{ request.args.get('t') }}">{% endif %}
              <button class="pill" type="submit">Add to Cart</button>
            </form>
            <!-- BUY NOW goes straight to single-item checkout -->
            <a class="pill" href="/checkout/{{ it.link_id }}{% if request.args.get('t') %}?t={{ request.args.get('t') }}{% endif %}">Buy now</a>
          </div>
        </div>
      </div>
    {% else %}
      <div class="muted">No items yet.</div>
    {% endfor %}
  </div>
</div>
</body>
</html>
