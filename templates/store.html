<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>{{ m.business_name }} â€” Store</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    :root{
      --bg:#0b0f17; --card:#0f1728; --line:#1f2a44; --txt:#e8f0ff; --muted:#bcd0ff;
      --brand:#6e9fff; --accent:#7ad1ff; --danger:#ff9aa2; --ok:#73e2a7;
    }
    [data-theme="light"]{
      --bg:#f7f9ff; --card:#ffffff; --line:#dde6ff; --txt:#0b0f17; --muted:#3b4a6a;
      --brand:#2b5cff; --accent:#0066cc; --danger:#b00020; --ok:#007a4b;
    }
    *{box-sizing:border-box}
    body{font-family:Arial,Helvetica,sans-serif;background:var(--bg);color:var(--txt);margin:0}
    a{color:inherit;text-decoration:none}
    .wrap{max-width:980px;margin:0 auto;padding:16px}
    .top{display:flex;align-items:center;gap:12px;justify-content:space-between;margin-bottom:12px}
    .brand{display:flex;align-items:center;gap:10px;min-width:0}
    .brand img.logo{height:36px;border-radius:8px;border:1px solid var(--line);background:#fff}
    .brand .info{min-width:0}
    .brand .name{font-weight:800;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .brand .desc{font-size:13px;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

    .bar{display:flex;gap:10px;align-items:center}
    .chip{border:1px solid var(--line);background:var(--card);border-radius:10px;padding:8px 10px;color:var(--muted)}
    .btn{background:var(--brand);color:#fff;border:0;border-radius:10px;padding:10px 12px;font-weight:800;cursor:pointer}
    .btn.outline{background:transparent;color:var(--brand);border:1px solid var(--brand)}
    .btn.small{padding:8px 10px;font-weight:700}
    .iconbtn{border:1px solid var(--line);background:var(--card);border-radius:10px;padding:8px 10px;cursor:pointer}
    .muted{color:var(--muted)}
    .banner{border:1px solid var(--line);background:var(--card);border-radius:14px;overflow:hidden;margin-bottom:12px}
    .banner img{width:100%;display:block;max-height:220px;object-fit:cover}

    .search{display:flex;gap:8px;margin:12px 0}
    .search input{flex:1;border:1px solid var(--line);background:var(--card);color:var(--txt);border-radius:10px;padding:10px}
    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    @media(min-width:740px){ .grid{grid-template-columns:repeat(3,1fr)} }
    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:10px;display:flex;flex-direction:column}
    .thumb{aspect-ratio:1/1;border-radius:10px;overflow:hidden;border:1px solid var(--line);background:#fff;margin-bottom:8px;display:flex;align-items:center;justify-content:center}
    .thumb img{width:100%;height:100%;object-fit:cover;display:block}
    .title{font-weight:800;margin:2px 0 6px;min-height:38px;line-height:1.15}
    .price{color:var(--muted);font-size:14px;margin-bottom:10px}
    .row{display:flex;gap:8px}
    .qty{width:64px;border:1px solid var(--line);background:var(--card);color:var(--txt);border-radius:10px;padding:8px 10px}

    .alert{background:rgba(115,226,167,.12);border:1px solid rgba(115,226,167,.35);color:var(--ok);padding:10px;border-radius:10px;margin-bottom:12px}
    .err{color:var(--danger)}
    .topbar{display:flex;gap:8px;align-items:center}
    .toggle{display:flex;align-items:center;gap:6px}
    .cartlink{position:relative}
    .badge{position:absolute;top:-8px;right:-8px;background:var(--accent);color:#fff;border-radius:999px;padding:2px 6px;font-size:12px;font-weight:800;border:2px solid var(--card)}
  </style>
  <script>
    // Theme toggle persisted
    (function(){
      const saved = localStorage.getItem('izzapay_theme');
      if (saved) document.documentElement.setAttribute('data-theme', saved);
    })();
  </script>
</head>
<body>
  <div class="wrap">

    <!-- Store header -->
    <div class="top">
      <div class="brand">
        {% if m.logo_url %}
          <img class="logo" src="{{ m.logo_url }}" alt="{{ m.business_name }}">
        {% endif %}
        <div class="info">
          <div class="name">{{ m.business_name }}</div>
          {% if m.description %}<div class="desc">{{ m.description }}</div>{% endif %}
        </div>
      </div>

      <div class="topbar">
        <div class="toggle">
          <button id="themeBtn" class="iconbtn" aria-label="Toggle theme">ðŸŒ“</button>
        </div>

        <a class="iconbtn cartlink" href="/cart/{{ cid }}{% if t %}?t={{ t }}{% endif %}">
          ðŸ›’ Cart
          {% if cart_count and cart_count|int > 0 %}
            <span class="badge">{{ cart_count }}</span>
          {% endif %}
        </a>
      </div>
    </div>

    {% if m.banner_url %}
      <div class="banner"><img src="{{ m.banner_url }}" alt="Store banner"></div>
    {% endif %}

    {% if request.args.get('success') %}
      <div class="alert">Payment succeeded! Thanks for shopping with {{ m.business_name }}.</div>
    {% endif %}

    <!-- Search -->
    <form class="search" method="get" action="/store/{{ m.slug }}">
      <input type="text" name="q" placeholder="Search productsâ€¦" value="{{ q or '' }}">
      <input type="hidden" name="cid" value="{{ cid }}">
      {% if t %}<input type="hidden" name="t" value="{{ t }}">{% endif %}
      <button class="btn small" type="submit">Search</button>
    </form>

    <!-- Product grid -->
    {% if items %}
      <div class="grid">
        {% for it in items %}
          <div class="card">
            <a class="thumb" href="/checkout/{{ it.link_id }}{% if t %}?t={{ t }}{% endif %}">
              {% if it.image_url %}
                <img src="{{ it.image_url }}" alt="{{ it.title }}">
              {% else %}
                <span class="muted">No image</span>
              {% endif %}
            </a>
            <div class="title">{{ it.title }}</div>
            <div class="price">{{ '%.7f'|format(it.pi_price) }} Pi</div>

            <div class="row" style="margin-top:auto">
              <!-- Add to cart -->
              <form method="post" action="/store/{{ m.slug }}/add{% if t %}?t={{ t }}{% endif %}" style="display:flex;gap:8px;flex:1">
                <input type="hidden" name="item_id" value="{{ it.id }}">
                <input type="hidden" name="cid" value="{{ cid }}">
                <input class="qty" type="number" min="1" step="1" name="qty" value="1" aria-label="Quantity">
                <button class="btn outline" type="submit">Add to cart</button>
              </form>

              <!-- Buy now -->
              <a class="btn" href="/checkout/{{ it.link_id }}{% if t %}?t={{ t }}{% endif %}">Buy now</a>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="muted">No products yet.</p>
    {% endif %}
  </div>

  <script>
    // Theme toggle
    const themeBtn = document.getElementById('themeBtn');
    themeBtn?.addEventListener('click', function(){
      const cur = document.documentElement.getAttribute('data-theme') || 'dark';
      const next = (cur === 'light') ? 'dark' : 'light';
      document.documentElement.setAttribute('data-theme', next);
      localStorage.setItem('izzapay_theme', next);
    });
  </script>
</body>
</html>
