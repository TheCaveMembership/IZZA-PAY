<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Izza Pay – Merchant</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;background:#0b0f17;color:#e8f0ff;margin:0;padding:20px}
    .wrap{max-width:920px;margin:0 auto}
    .card{background:#111a2b;border:1px solid #1f2a44;padding:20px;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,.25);margin-bottom:16px}
    input,button,select,textarea{width:100%;padding:12px;border-radius:10px;border:1px solid #2b3b61;background:#0e1422;color:#e8f0ff;margin:6px 0}
    button{background:#6e9fff;color:#0b0f17;border:0;font-weight:700;cursor:pointer}
    button:hover{opacity:.95}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .error{background:#3b0e17;color:#ffd5d5;padding:10px;border-radius:8px;margin-bottom:10px}
    .muted{opacity:.85;font-size:.95em}
    .badge{display:inline-block;padding:3px 8px;border-radius:999px;background:#20304f;color:#b2c7ff;font-size:12px;margin-bottom:10px}
    a.nav{color:#bcd0ff;text-decoration:none;margin-right:10px}
  </style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <div class="badge">MERCHANT DASHBOARD</div>
    {% if m %}
      <h2>{{ m['business_name'] }}</h2>
      <div class="muted">Store slug: <strong>{{ m['slug'] }}</strong></div>
      <div style="margin-top:8px">
        <a class="nav" href="/merchant/{{ m['slug'] }}/items{% if t %}?t={{t}}{% endif %}">Items</a>
        <a class="nav" href="/merchant/{{ m['slug'] }}/orders{% if t %}?t={{t}}{% endif %}">Orders</a>
      </div>
    {% else %}
      <h2>Create your merchant profile</h2>
      <p class="muted">Choose a short, unique <strong>store slug</strong> (lowercase, a-z, 0-9, hyphens).  
      Set your payout <strong>Pi Wallet Address</strong> (public key, 56 chars starting with G).  
      @handle is optional and for display only.</p>
    {% endif %}
  </div>

  {% if error %}
    <div class="card error">{{ error }}</div>
  {% endif %}

  {% if setup_mode %}
    <form class="card" method="POST" action="/merchant/setup">
      {% if t %}<input type="hidden" name="t" value="{{ t }}">{% endif %}
      <label>Business name</label>
      <input name="business_name" placeholder="e.g., Izza Pay Collectibles">
      <div class="row">
        <div>
          <label>Store slug</label>
          <input name="slug" placeholder="e.g., izzapay-collectibles">
        </div>
        <div>
          <label>Theme</label>
          <select name="theme_mode">
            <option value="dark" selected>Dark</option>
            <option value="light">Light</option>
          </select>
        </div>
      </div>
      <label>Logo URL</label>
      <input name="logo_url" placeholder="https://.../logo.png">
      <div class="row">
        <div>
          <label>Contact email (order alerts)</label>
          <input name="reply_to_email" placeholder="name@store.com">
        </div>
        <div>
          <label>@handle (optional)</label>
          <input name="pi_handle" placeholder="@yourhandle">
        </div>
      </div>
      <label>Payout Pi Wallet Address (public key)</label>
      <input name="pi_wallet_address" placeholder="G................................................." maxlength="56">

      <button type="submit">Create merchant</button>
    </form>
  {% else %}
    <div class="card">
      <h3>Create a new item</h3>
      <form method="POST" action="/merchant/{{ m['slug'] }}/items/new{% if t %}?t={{t}}{% endif %}">
        <div class="row">
          <div><label>Title</label><input name="title" placeholder="e.g., Sports Card Pack A"></div>
          <div><label>SKU</label><input name="sku" placeholder="SKU-001"></div>
        </div>
        <label>Image URL</label>
        <input name="image_url" placeholder="https://.../image.jpg">
        <div class="row">
          <div><label>Price (Pi)</label><input name="pi_price" type="number" step="0.0000001" placeholder="1.5"></div>
          <div><label>Stock Qty</label><input name="stock_qty" type="number" step="1" placeholder="10"></div>
        </div>
        <label><input type="checkbox" name="allow_backorder"> Allow backorder when out of stock</label>
        <button type="submit">Add item</button>
      </form>
    </div>

    <div class="card">
      <h3>Your items</h3>
      {% if items|length == 0 %}
        <p class="muted">No items yet.</p>
      {% else %}
        <ul>
          {% for it in items %}
            <li style="margin-bottom:8px">
              <strong>{{ it['title'] }}</strong> — {{ it['pi_price'] }} Pi
              <div class="muted">
                Link ID: <code>{{ it['link_id'] }}</code> •
                Pay button URL: <code>{{ app_base }}/checkout/{{ it['link_id'] }}</code>
              </div>
            </li>
          {% endfor %}
        </ul>
      {% endif %}
    </div>
  {% endif %}
</div>
</body>
</html>
